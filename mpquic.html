<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multipath QUIC &mdash; Modern Multipath Transport Protocols 2022 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SCTP" href="sctp.html" />
    <link rel="prev" title="Multipath TCP" href="mptcp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="index.html" class="icon icon-home"> Modern Multipath Transport Protocols
          </a>
              <div class="version">
                alpha
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlepath.html">Single path transport protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="quic.html">QUIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="principles.html">Principles of multipath transport</a></li>
<li class="toctree-l1"><a class="reference internal" href="mptcp.html">Multipath TCP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multipath QUIC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#migrating-quic-connections">Migrating QUIC connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sctp.html">SCTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementations.html">Multipath TCP implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mptcp-linux.html">Multipath TCP on recent Linux kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison.html">Alternatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="biblio.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Modern Multipath Transport Protocols</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Multipath QUIC</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/obonaventure/mmtp-book/blob/mainmpquic.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="multipath-quic">
<h1>Multipath QUIC<a class="headerlink" href="#multipath-quic" title="Permalink to this headline"></a></h1>
<p>As the development of QUIC progressed within the IETF, academic researchers have started to explore how QUIC could be extended with multipath capabilities. The first approaches built upon Google’s version of QUIC. The first prototype was implemented inside <code class="docutils literal notranslate"><span class="pre">quic-go</span></code> <span id="id1">[<a class="reference internal" href="biblio.html#id8889" title="Quentin De Coninck and Olivier Bonaventure. Multipath quic: design and evaluation. In Proceedings of the 13th international conference on emerging networking experiments and technologies, 160–166. 2017.">71</a>]</span>. A second version of the protocol which can be easily extended using plugins was then proposed inside <code class="docutils literal notranslate"><span class="pre">picoquic</span></code> <span id="id2">[<a class="reference internal" href="biblio.html#id8897" title="Quentin De Coninck, François Michel, Maxime Piraux, Florentin Rochet, Thomas Given-Wilson, Axel Legay, Olivier Pereira, and Olivier Bonaventure. Pluginizing quic. In Proceedings of the ACM Special Interest Group on Data Communication, pages 59–74. 2019.">72</a>]</span>. An alternative approach was proposed in <span id="id3">[<a class="reference internal" href="biblio.html#id8890" title="Tobias Viernickel, Alexander Froemmgen, Amr Rizk, Boris Koldehofe, and Ralf Steinmetz. Multipath quic: a deployable multipath transport protocol. In 2018 IEEE International Conference on Communications (ICC), 1–7. IEEE, 2018.">73</a>]</span>. The most recent solutions <span id="id4">[<a class="reference internal" href="biblio.html#id8891" title="Quentin De Coninck and Olivier Bonaventure. Multiflow quic: a generic multipath transport protocol. IEEE Communications Magazine, 59(5):108–113, 2021.">74</a>, <a class="reference internal" href="biblio.html#id8898" title="Zhilong Zheng, Yunfei Ma, Yanmei Liu, Furong Yang, Zhenyu Li, Yuanbo Zhang, Jiuhai Zhang, Wei Shi, Wentao Chen, Ding Li, and others. Xlink: qoe-driven multi-path quic transport in large-scale video services. In Proceedings of the 2021 ACM SIGCOMM 2021 Conference, 418–432. 2021.">75</a>]</span> leverage the most recent QUIC specification as described in this document.</p>
<p>Discussions within the IETF took some time to start, despite early proposals <span id="id5">[<a class="reference internal" href="biblio.html#id8896" title="Quentin De Coninck and Olivier Bonaventure. Multipath Extension for QUIC. Internet-Draft draft-deconinck-multipath-quic-00, Internet Engineering Task Force, October 2017. Work in Progress. URL: https://datatracker.ietf.org/doc/html/draft-deconinck-multipath-quic-00.">76</a>]</span>. Recently, the QUIC working group adopted <span id="id6">[<a class="reference internal" href="biblio.html#id8892" title="Yanmei Liu, Yunfei Ma, Quentin De Coninck, Olivier Bonaventure, Christian Huitema, and Mirja Kühlewind. Multipath Extension for QUIC. Internet-Draft draft-lmbdhk-quic-multipath-00, Internet Engineering Task Force, October 2021. Work in Progress. URL: https://datatracker.ietf.org/doc/html/draft-lmbdhk-quic-multipath-00.">77</a>]</span> as a starting point for the development of an IETF specification for multipath QUIC. It combines the ideas initially proposed in three different drafts <span id="id7">[<a class="reference internal" href="biblio.html#id8895" title="Yanmei Liu, Yunfei Ma, Christian Huitema, Qing An, and Zhenyu Li. Multipath Extension for QUIC. Internet-Draft draft-liu-multipath-quic-04, Internet Engineering Task Force, September 2021. Work in Progress. URL: https://datatracker.ietf.org/doc/html/draft-liu-multipath-quic-04.">78</a>, <a class="reference internal" href="biblio.html#id8893" title="Quentin De Coninck and Olivier Bonaventure. Multipath Extensions for QUIC (MP-QUIC). Internet-Draft draft-deconinck-quic-multipath-07, Internet Engineering Task Force, May 2021. Work in Progress. URL: https://datatracker.ietf.org/doc/html/draft-deconinck-quic-multipath-07.">79</a>, <a class="reference internal" href="biblio.html#id8894" title="Christian Huitema. QUIC Multipath Negotiation Option. Internet-Draft draft-huitema-quic-mpath-option-01, Internet Engineering Task Force, September 2021. Work in Progress. URL: https://datatracker.ietf.org/doc/html/draft-huitema-quic-mpath-option-01.">80</a>]</span>.</p>
<section id="migrating-quic-connections">
<h2>Migrating QUIC connections<a class="headerlink" href="#migrating-quic-connections" title="Permalink to this headline"></a></h2>
<p>As explained above, QUIC uses connection identifiers. These connection identifiers are used for different purposes. On the server side, they can be used by load-balancers to spread the packets of different connections to different servers. But QUIC ‘s connection identifiers also enable clients to migrate connections from one path to another or even on the same path.</p>
<p>QUIC connection migrations occur in two steps. As an example, we consider client triggered migrations. These are the most important from a deployment viewpoint. A client can decide to migrate its connection for various reasons, including privacy and performance. A common scenario is a smartphone that moves and goes progressively out of reach of the Wi-Fi access point. When the smartphone notices a decrease in performance of the Wi-Fi network (lower signal to noise ratio, more losses or retransmissions, …), it can decide to migrate the QUIC connections over the cellular interface. A naive solution would be to simply move the QUIC packets from one interface to another using the same connection identifiers. This is illustrated in <a class="reference internal" href="#fig-quic-naive-migration"><span class="std std-numref">Fig. 81</span></a>. The QUIC connection was established from the client IP address, <span class="math notranslate nohighlight">\(IP_C\)</span>, to the server’s IP address, <span class="math notranslate nohighlight">\(IP_S\)</span>. The first two packets show a simple exchange over this connection. Before sending its second packet, the client decides to use its second interface to send the subsequent packets. This interface is illustrated in red on the figure and its IP address is <span class="math notranslate nohighlight">\(IP_X\)</span>. The client sends its second packet over this interface.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">\tikzmath{\c1=1;\c2=1.5; \s1=8; \s2=8.5; \max=5; }
\tikzstyle{every node}=[font=\small]
\tikzstyle{arrow} = [thick,-&gt;,&gt;=stealth]
\tikzset{state/.style={rectangle, dashed, draw, fill=white} }
\node [black, fill=white] at (\c1,\max) {Client};
\node [black, fill=white] at (\s1,\max) {Server};

\draw[black,thick,-&gt;] (\c1-0.5,\max-0.5) -- (\c1-0.5,0.5);
\draw[red,dashed,thick,-&gt;] (\c1+0.5,\max-0.5) -- (\c1+0.5,0.5);
\draw[black,thick,-&gt;] (\s1,\max-0.5) -- (\s1,0.5);

\tikzmath{\y=\max-1;}
\draw[black,thick, -&gt;] (\c1-0.5,\y) -- (\s1,\y-1) node [midway, align=center, fill=white]  {src=$IP_C$,dst=$IP_S$,DCID=$\alpha$\\1-RTT(...)};
\draw[black,thick, -&gt;] (\s1,\y-1) -- (\c1-0.5,\y-2) node [midway, align=center, fill=white]  {src=$IP_S$,dst=$IP_C$\\1-RTT(...)};
\draw[red,thick, -&gt;] (\c1+0.5,\y-2) -- (\s1,\y-3) node [midway, align=center, fill=white]  {src=$IP_X$,dst=$IP_S$,DCID=$\alpha$\\1-RTT(...)};
\draw[red,thick, -&gt;] (\s1,\y-3) -- (\c1+0.5,\y-4) node [midway, align=center, fill=white]  {src=$IP_S$,dst=$IP_X$\\1-RTT(...)};</span>)</p>
<p>! LaTeX Error: File `bytefield27.sty' not found.

Type X to quit or &lt;RETURN&gt; to proceed,
or enter new name. (Default extension: sty)

Enter file name: 
! Emergency stop.
&lt;read *&gt; 
         
l.16 \\tikzset
             {router/.style = {rectangle, draw, text centered, minimum heigh...

!  ==&gt; Fatal error occurred, no output PDF file produced!
Transcript written on tikz-28e0d9d037faa452df30f82c6dddd856d52b69e7.log.
&quot;</p>
</div>
<p><span class="caption-number">Fig. 81 </span><span class="caption-text">A naive approach to migrate a QUIC connection from Wi-Fi to cellular</span></p>
</div><p>Unfortunately, this naive approach has several problems. Consider the server that receives the first QUIC packet from the smartphone’s cellular interface. This packet originates from a different IP address than the previous one, but still belongs to the same connection. If the server accepts this packet and moves the connection to the cellular path, this creates several security risks. First, consider an attacker who has captured a packet over the Wi-Fi network. By sending again this unmodified packet from another IP address, the attacker could disrupt the ongoing connection by forcing the server to send replies to its own IP address. This also opens a risk of denial of service attack as the server could send a large number of packets to the smartphone’s new IP address. QUIC copes with these problems by using path-specific connection identifiers and the path validation mechanism.</p>
<p>To enable a client to migrate a QUIC connection, the server must first advertise at least one different connection identifier. This is done with the <code class="docutils literal notranslate"><span class="pre">NEW_CONNECTION_ID</span></code> frame. The client uses this additional connection identifier to try to move the connection to a new path. The client cannot use a new path before having the guarantee that the server can reply over the new path. To verify that the new path is bidirectional, the client sends a <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code> frame in a QUIC packet that uses the new connection identifier over the new path. This frame mainly contains a 64 bits random nonce that must be echoed by the server. It also includes some padding to check the path’s MTU as done during the handshake. Upon reception of this packet, the server detects an attempt to use a new path with the new connection identifier. It replies with a <code class="docutils literal notranslate"><span class="pre">PATH_RESPONSE</span></code> frame that echoes the client nonce. The server may also perform its own path validation by sending a <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code> with a different nonce in the same packet as the <code class="docutils literal notranslate"><span class="pre">PATH_RESPONSE</span></code>. The client considers that the path has been validated upon reception of the valid <code class="docutils literal notranslate"><span class="pre">PATH_RESPONSE</span></code> frame. The packets that contain the <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code> and <code class="docutils literal notranslate"><span class="pre">PATH_RESPONSE</span></code> frames are usually padded with <code class="docutils literal notranslate"><span class="pre">PADDING</span></code> frames. The client then switches to the new connection identifier and the new path for all the frames that it sends. It may still continue to receive packets over the former path for some time. The server will switch to the new path once it has received a response to its <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code> if it decided to validate the new path. Otherwise, the reception of a QUIC packet that contains other frames than <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code>, <code class="docutils literal notranslate"><span class="pre">PATH_RESPONSE</span></code>, <code class="docutils literal notranslate"><span class="pre">NEW_CONNECTION_ID</span></code> or <code class="docutils literal notranslate"><span class="pre">PADDING</span></code> also indicates that the path is active. The client could send a <code class="docutils literal notranslate"><span class="pre">NEW_CONNECTION_ID</span></code> frame together with the <code class="docutils literal notranslate"><span class="pre">PATH_CHALLENGE</span></code> frame if the client uses a non-null connection identifier and it has not sent a <code class="docutils literal notranslate"><span class="pre">NEW_CONNECTION_ID</span></code> frame before. This is illustrated in <a class="reference internal" href="#fig-quic-client-migration"><span class="std std-numref">Fig. 82</span></a>.</p>
<div class="figure" id="id11" style="text-align: center">
<span id="fig-quic-client-migration"></span><p><img  src="None" alt="Figure made with TikZ" /></p>
<p><span class="caption-number">Fig. 82 </span><span class="caption-text">A QUIC connection migration initiated by the client</span></p>
</div><p>The examples above showed a connection that migrates from one network interface to another. This is expected to be a frequent situation for smartphones that move. However, there are also scenarios where the client can trigger a connection migration even if it uses a single network interface. First, the client application can decide to migrate its QUIC connection every <span class="math notranslate nohighlight">\(n\)</span> minutes. This could be useful for an application that provides a VPN-like service as proposed <span id="id8">[<a class="reference internal" href="biblio.html#id8897" title="Quentin De Coninck, François Michel, Maxime Piraux, Florentin Rochet, Thomas Given-Wilson, Axel Legay, Olivier Pereira, and Olivier Bonaventure. Pluginizing quic. In Proceedings of the ACM Special Interest Group on Data Communication, pages 59–74. 2019.">72</a>]</span>. By regularly changing their connection identifiers, such VPN services could prevent some middleboxes from detecting and blocking them. Another scenario are the unintended migrations caused by NAT.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unintended QUIC connection migrations</p>
<p>We have described how QUIC clients can trigger connection migrations. There are situations when connection migration occurs without being triggered by the client. A classical example is when there is a NAT on the path between the client and the server. The QUIC connection has been idle for some time and the NAT has removed the mapping from the client’s private IP address to a public one. When the client sends the next packet over the connection, the NAT creates a new mapping and thus assigns a different IP address to the client. The server receives a packet that uses the same connection identifier but comes from a different IP address than the initial one. This is illustrated in <a class="reference internal" href="#fig-quic-nat-migration"><span class="std std-numref">Fig. 83</span></a>. Upon reception of the QUIC packet coming from the new IP address (shown in red in <a class="reference internal" href="#fig-quic-nat-migration"><span class="std std-numref">Fig. 83</span></a>, the server triggers a path validation. Once the path has been validated, the QUIC connection can continue.</p>
</div>
<div class="figure" id="id12" style="text-align: center">
<span id="fig-quic-nat-migration"></span><p><img  src="None" alt="Figure made with TikZ" /></p>
<p><span class="caption-number">Fig. 83 </span><span class="caption-text">A QUIC connection migration triggered by a NAT</span></p>
</div><p>The previous examples have shown that a client can trigger a connection migration to improve performance or for privacy reasons. Our examples have considered that the clients can use different IP addresses while the servers have a stable IP address. This corresponds to most deployments, but not all of them. Today, many servers are dual-stack. They support both IPv4 and IPv6. When a client starts a QUIC connection over one address family, it could be useful for the client to learn the other server address to be able to switch to this address if the other fails. Another interesting type of deployments are the server farms where each server has both an anycast address and a unicast one. All servers use the same anycast address and this address is the one advertised using the DNS. When a client initiates a QUIC connection, it targets the anycast address. The <code class="docutils literal notranslate"><span class="pre">Initial</span></code> QUIC packet is load-balanced to one of the servers of the farm and all subsequent packets of this connection are load-balanced to the same server. In this deployment, all packets must be processed by the load-balancer before reaching the server. When the load is high, the load-balancer could become a bottleneck and it would be useful to allow QUIC connections to migrate to the unicast address of their servers since unicast address bypasses the load-balancer. The first version of QUIC provides partial support for this bypass by allowing the server to advertise its preferred unicast addresses (IPv4 and IPv6) using the <code class="docutils literal notranslate"><span class="pre">preferred_address</span></code> transport parameter during the handshake. However, according to QUIC specification <span id="id9">[<a class="reference internal" href="biblio.html#id8812" title="J. Iyengar (Ed.) and M. Thomson (Ed.). QUIC: A UDP-Based Multiplexed and Secure Transport. RFC 9000 (Proposed Standard), May 2021. URL: https://www.rfc-editor.org/rfc/rfc9000.txt, doi:10.17487/RFC9000.">8</a>]</span>, a client SHOULD, but is not forced to, migrate to one of the preferred addresses announced by the server. This migration can only be triggered by the client, there is no way for the server to impose a migration.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mptcp.html" class="btn btn-neutral float-left" title="Multipath TCP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sctp.html" class="btn btn-neutral float-right" title="SCTP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Olivier Bonaventure.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>